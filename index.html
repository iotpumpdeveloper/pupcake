<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Pupcake by superjimpupcake</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/superjimpupcake/Pupcake">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/superjimpupcake/Pupcake/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/superjimpupcake/Pupcake/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Pupcake</h1>
          <p>Pupcake, a PHP 5.3+ application framework</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/superjimpupcake">superjimpupcake</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></span>
        </div>

        <h1>Pupcake --- a micro framework for PHP 5.3+</h1>

<h2>About Pupcake Framework</h2>

<ul>
<li>Pupcake is a minimal but extensible microframework for PHP 5.3+</li>
<li>Pupcake can be run in traditional web server such as Apache.</li>
<li>Pupcake can be run in command line with event based functionalities like Node.js by using the Node plugin together withg php-uv and php-httpparser extensions</li>
<li>For more detail usages on using pupcake in general and on traditional web servers, please see <a href="https://github.com/superjimpupcake/Pupcake/wiki/_pages">https://github.com/superjimpupcake/Pupcake/wiki/_pages</a>
</li>
<li>To see what pupcake can do like Node.js, check out this README page, the Node plugin is under actively development and will provide more features down the road</li>
</ul><h2>Installation:</h2>

<h3>If you plan to use it on Apache</h3>

<h4>install package "Pupcake/Pupcake" using composer (<a href="http://getcomposer.org/">http://getcomposer.org/</a>)</h4>

<h4>.htaccess File for Apache</h4>

<pre><code>RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.*)$ index.php/$1 [L]
</code></pre>

<h3>If you plan to use it like Node.js</h3>

<h4>install package "Pupcake/Pupcake" using composer (<a href="http://getcomposer.org/">http://getcomposer.org/</a>)</h4>

<h4>install sockets extension (<a href="http://www.php.net/manual/en/sockets.installation.php">http://www.php.net/manual/en/sockets.installation.php</a>)</h4>

<h4>install php-uv and php-httpparser</h4>

<pre><code>git clone https://github.com/chobie/php-uv.git --recursive
cd php-uv/libuv
make &amp;&amp; cp uv.a libuv.a (my experience on both centos 64bit and ubuntu 64bit server is, we need to add -fPIC flag in config.m4)
cd ..
phpize
./configure
make &amp;&amp; make install (my experience on both centos64bit and ubuntu64bit  server is, we need to add -fPIC flag in config.m4)

git clone https://github.com/chobie/php-httpparser.git --recursive
cd php-httpparser
phpize
./configure
make &amp;&amp; make install

add following extensions to your php.ini
extension=uv.so
extension=httpparser.so
</code></pre>

<h3>Simple requests when running on Apache</h3>

<h4>For more details on running Pupcake in general and in traditional web server, please see <a href="https://github.com/superjimpupcake/Pupcake/wiki/_pages">https://github.com/superjimpupcake/Pupcake/wiki/_pages</a>
</h4>

<div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">//Assuming this is public/index.php and the composer vendor directory is ../vendor</span>

<span class="k">require_once</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">'/../vendor/autoload.php'</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Pupcake\Pupcake</span><span class="p">();</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">"date/:year/:month/:day"</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$req</span><span class="p">,</span> <span class="nv">$res</span><span class="p">){</span>
    <span class="nv">$output</span> <span class="o">=</span> <span class="nv">$req</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">(</span><span class="s1">'year'</span><span class="p">)</span><span class="o">.</span><span class="s1">'-'</span><span class="o">.</span><span class="nv">$req</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">(</span><span class="s1">'month'</span><span class="p">)</span><span class="o">.</span><span class="s1">'-'</span><span class="o">.</span><span class="nv">$req</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">(</span><span class="s1">'day'</span><span class="p">);</span>
    <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$output</span><span class="p">);</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">"/hello/:name"</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$req</span><span class="p">,</span> <span class="nv">$res</span><span class="p">){</span>
  <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="s2">"hello "</span><span class="o">.</span><span class="nv">$req</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span><span class="o">.</span><span class="s2">" in get"</span><span class="p">);</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s2">"/hello/:name"</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$req</span><span class="p">,</span> <span class="nv">$res</span><span class="p">){</span>
  <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="s2">"hello "</span><span class="o">.</span><span class="nv">$req</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span><span class="o">.</span><span class="s2">" in post"</span><span class="p">);</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="s2">"/hello/:name"</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$req</span><span class="p">,</span> <span class="nv">$res</span><span class="p">){</span>
  <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="s2">"hello "</span><span class="o">.</span><span class="nv">$req</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span><span class="o">.</span><span class="s2">" in put"</span><span class="p">);</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s2">"/hello/:name"</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$req</span><span class="p">,</span> <span class="nv">$res</span><span class="p">){</span>
  <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="s2">"hello "</span><span class="o">.</span><span class="nv">$req</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span><span class="o">.</span><span class="s2">" in delete"</span><span class="p">);</span>
<span class="p">});</span>

<span class="sd">/**</span>
<span class="sd"> * Multiple request methods for one route</span>
<span class="sd"> */</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="s2">"/api/hello/:action"</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$req</span><span class="p">,</span> <span class="nv">$res</span><span class="p">){</span>
  <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="s2">"hello "</span><span class="o">.</span><span class="nv">$req</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">(</span><span class="s1">'action'</span><span class="p">)</span><span class="o">.</span><span class="s2">" in get and post"</span><span class="p">);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">via</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span><span class="s1">'POST'</span><span class="p">);</span>


<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</pre></div>

<h3>Using the node plugin: console.log</h3>

<div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">//Assuming this is server/server.php and the composer vendor directory is ../vendor</span>

<span class="k">require_once</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">'/../vendor/autoload.php'</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Pupcake\Pupcake</span><span class="p">();</span>
<span class="nv">$node</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">usePlugin</span><span class="p">(</span><span class="s2">"Pupcake.Plugin.Node"</span><span class="p">);</span> <span class="c1">//here we import the node plugin</span>
<span class="nv">$console</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">import</span><span class="p">(</span><span class="s2">"console"</span><span class="p">);</span>
<span class="nv">$console</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">);</span>
</pre></div>

<p>To run the code above, type php server/server.php
In the code above, we simply use the node plugin and then import the console module to output "hello" to the console.</p>

<h3>Using the node plugin: process.nextTick</h3>

<p>In the script below, we define a dynamic method named "hello" in a Node plugin instance, then we use the process module to keep calling the hello method in every single "tick" 
in an async fashion.</p>

<div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">//Assuming this is public/index.php and the composer vendor directory is ../vendor</span>
<span class="k">require_once</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">'/../vendor/autoload.php'</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Pupcake\Pupcake</span><span class="p">();</span>
<span class="nv">$node</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">usePlugin</span><span class="p">(</span><span class="s2">"Pupcake.Plugin.Node"</span><span class="p">);</span>
<span class="nv">$node</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$node</span><span class="p">){</span>
  <span class="nv">$console</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">import</span><span class="p">(</span><span class="s2">"console"</span><span class="p">);</span> <span class="c1">//use the console module</span>
  <span class="nv">$console</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">(</span><span class="s2">"doing some tasks"</span><span class="p">);</span>
  <span class="nv">$process</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">import</span><span class="p">(</span><span class="s2">"process"</span><span class="p">);</span> <span class="c1">//use the process module</span>
  <span class="nv">$process</span><span class="o">-&gt;</span><span class="na">nextTick</span><span class="p">(</span><span class="k">function</span><span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$node</span><span class="p">){</span>
    <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">hello</span><span class="p">();</span> 
  <span class="p">});</span>
<span class="p">});</span>

<span class="nv">$node</span><span class="o">-&gt;</span><span class="na">hello</span><span class="p">();</span>
</pre></div>

<h3>Using the node plugin: http.createServer, benchmarked with Node.js v0.8.8, our php server is faster than node.js and can handle high number of concurrent requests</h3>

<p>In the example below, we mimic the node.js's http server creation process and send "Hello World" to the browser</p>

<div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">//Assuming this is server/server.php and the composer vendor directory is ../vendor</span>
<span class="k">require_once</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">'/../vendor/autoload.php'</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Pupcake\Pupcake</span><span class="p">();</span>
<span class="nv">$node</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">usePlugin</span><span class="p">(</span><span class="s2">"Pupcake.Plugin.Node"</span><span class="p">);</span>

<span class="nv">$console</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">import</span><span class="p">(</span><span class="s2">"console"</span><span class="p">);</span>
<span class="nv">$http</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">import</span><span class="p">(</span><span class="s2">"http"</span><span class="p">);</span>

<span class="nv">$http</span><span class="o">-&gt;</span><span class="na">createServer</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$req</span><span class="p">,</span> <span class="nv">$res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'Content-Type'</span> <span class="o">=&gt;</span> <span class="s1">'text/plain'</span><span class="p">));</span>
  <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">end</span><span class="p">(</span><span class="s2">"Hello World</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">listen</span><span class="p">(</span><span class="mi">1337</span><span class="p">,</span> <span class="s1">'127.0.0.1'</span><span class="p">);</span>
<span class="nv">$console</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">(</span><span class="s1">'Server running at http://127.0.0.1:1337/'</span><span class="p">);</span>
</pre></div>

<p>Simply run php server/server.php and you can see the result from <a href="http://127.0.0.1:1337/">http://127.0.0.1:1337/</a></p>

<p>Below is the benchmark comparison with Node.js</p>

<p>Benchmarking compared with the following node.js script</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span>
<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span><span class="o">:</span> <span class="s1">'text/plain'</span><span class="p">});</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'Hello World\n'</span><span class="p">);</span>
    <span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">1337</span><span class="p">,</span> <span class="s1">'127.0.0.1'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Server running at http://127.0.0.1:1337/'</span><span class="p">);</span>
</pre></div>

<p>Below are the data return by apache ab, apache ab is set with n=100000 and c=2000</p>

<p>Our php "hello world" script above</p>

<pre><code>Concurrency Level:      2000
Time taken for tests:   17.058 seconds
Complete requests:      100000
Failed requests:        0
Write errors:           0
Total transferred:      5730381 bytes
HTML transferred:       1206396 bytes
Requests per second:    5862.34 [#/sec] (mean)
Time per request:       341.161 [ms] (mean)
Time per request:       0.171 [ms] (mean, across all concurrent requests)
Transfer rate:          328.06 [Kbytes/sec] received
</code></pre>

<p>The Node.js "hello world" script above</p>

<pre><code>Concurrency Level:      2000
Time taken for tests:   23.661 seconds
Complete requests:      100000
Failed requests:        0
Write errors:           0
Total transferred:      11300000 bytes
HTML transferred:       1200000 bytes
Requests per second:    4226.29 [#/sec] (mean)
Time per request:       473.228 [ms] (mean)
Time per request:       0.237 [ms] (mean, across all concurrent requests)
Transfer rate:          466.38 [Kbytes/sec] received
</code></pre>

<h3>Using the node plugin: http.createServer and multiple servers on different ports</h3>

<p>In the example below, we created 3 different server instances to server port 1337, 9000 and 9001, all in one single event loop</p>

<div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">//Assuming this is server/server.php and the composer vendor directory is ../vendor</span>
<span class="k">require_once</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">'/../vendor/autoload.php'</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Pupcake\Pupcake</span><span class="p">();</span>
<span class="nv">$node</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">usePlugin</span><span class="p">(</span><span class="s2">"Pupcake.Plugin.Node"</span><span class="p">);</span>

<span class="nv">$console</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">import</span><span class="p">(</span><span class="s2">"console"</span><span class="p">);</span>
<span class="nv">$http</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">import</span><span class="p">(</span><span class="s2">"http"</span><span class="p">);</span>

<span class="nv">$http</span><span class="o">-&gt;</span><span class="na">createServer</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$req</span><span class="p">,</span> <span class="nv">$res</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$node</span><span class="p">){</span>
  <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'Content-Type'</span> <span class="o">=&gt;</span> <span class="s1">'text/plain'</span><span class="p">));</span>
  <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">end</span><span class="p">(</span><span class="s2">"Hello World On Port 1337</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">listen</span><span class="p">(</span><span class="mi">1337</span><span class="p">,</span> <span class="s1">'127.0.0.1'</span><span class="p">);</span>
<span class="nv">$console</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">(</span><span class="s1">'Server running at http://127.0.0.1:1337/'</span><span class="p">);</span>

<span class="nv">$http</span><span class="o">-&gt;</span><span class="na">createServer</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$req</span><span class="p">,</span> <span class="nv">$res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'Content-Type'</span> <span class="o">=&gt;</span> <span class="s1">'text/plain'</span><span class="p">));</span>
  <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">end</span><span class="p">(</span><span class="s2">"Hello World On Port 9000</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">listen</span><span class="p">(</span><span class="mi">9000</span><span class="p">,</span> <span class="s1">'127.0.0.1'</span><span class="p">);</span>
<span class="nv">$console</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">(</span><span class="s1">'Server running at http://127.0.0.1:9000/'</span><span class="p">);</span>

<span class="nv">$http</span><span class="o">-&gt;</span><span class="na">createServer</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$req</span><span class="p">,</span> <span class="nv">$res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'Content-Type'</span> <span class="o">=&gt;</span> <span class="s1">'text/plain'</span><span class="p">));</span>
  <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">end</span><span class="p">(</span><span class="s2">"Hello World On Port 9001</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">listen</span><span class="p">(</span><span class="mi">9001</span><span class="p">,</span> <span class="s1">'127.0.0.1'</span><span class="p">);</span>
<span class="nv">$console</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">(</span><span class="s1">'Server running at http://127.0.0.1:9001/'</span><span class="p">);</span>
</pre></div>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>